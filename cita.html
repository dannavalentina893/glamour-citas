<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glamour & Citas - Agenda tu Cita</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            background-color: #f5f5f5;
            margin: 0;
        }
        .header {
            background-color: gold;
            padding: 20px;
        }
        .navbar a {
            color: black;
            margin: 10px;
        }
        .content-wrapper {
            width: 800px;
            margin: 20px auto;
        }
        .seccion-cita {
            background-color: white;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid gold;
        }
        .seccion-cita h2 {
            color: gold;
        }
        .form-group {
            margin: 10px 0;
        }
        .formulario-cita input,
        .formulario-cita select,
        .formulario-cita textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid gold;
        }
        .btn-enviar {
            background-color: gold;
            color: black;
            padding: 10px;
            border: none;
            width: 100%;
        }
        .footer {
            background-color: gold;
            padding: 20px;
            text-align: center;
        }
        .red-box {
            background-color: white;
            padding: 10px;
            margin: 10px;
            border: 1px solid black;
            display: inline-block;
        }
        .red-box a {
            color: black;
        }
    </style>
</head>
<body>

    <header class="header">
        <div class="logo-container">
            <img src="img/logo.png" style="height:40px; vertical-align:middle; margin-right:10px;">
            <span class="logo-text">G&C</span>
            <h1>Glamour & Citas</h1>
        </div>
        <nav class="navbar">
            <a href="index.html">Inicio</a>
            <a href="servicios.html">Servicios</a>
            <a href="cita.html" class="active">Cita</a>
            <a href="productos.html">Productos</a>
        </nav>
    </header>

    <main class="content-wrapper">

        <section id="cita" class="seccion-cita">
            <h2>Agenda tu Cita de Lujo</h2>
            <p>Selecciona el servicio que deseas: Corte de Cabello, Masaje o Arreglo de Uñas.</p>

            <form id="formularioCita" class="formulario-cita">
                <div class="form-group">
                    <label for="nombre">Nombre Completo:</label>
                    <input type="text" id="nombre" name="nombre" required>
                </div>
                <div class="form-group">
                    <label for="telefono">Teléfono:</label>
                    <input type="tel" id="telefono" name="telefono" placeholder="Ej: 3001234567" required>
                </div>
                <div class="form-group">
                    <label for="email">Email (opcional):</label>
                    <input type="email" id="email" name="email" placeholder="ejemplo@mail.com">
                </div>
                <div class="form-group">
                    <label for="fecha">Fecha:</label>
                    <input type="date" id="fecha" name="fecha" min="" required>
                </div>
                <div class="form-group">
                    <label for="hora">Hora:</label>
                    <input type="time" id="hora" name="hora" min="09:00" max="19:00" step="1800" required>
                    <small style="display:block; margin-top:5px; color:#888; font-size:0.85em;">Horario de atención: 9:00 AM - 7:00 PM</small>
                </div>
                <div class="form-group">
                    <label for="servicio">Servicio Deseado:</label>
                    <select id="servicio" name="servicio" required>
                        <option value="">-- Selecciona uno --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="deseo">Detalles / Notas adicionales:</label>
                    <textarea id="deseo" name="deseo" rows="4" placeholder="Ej: Corte fade, preferencias especiales, alergias conocidas..."></textarea>
                </div>
                <div id="mensajeValidacion" style="margin: 15px 0; padding: 10px; border-radius: 5px; display: none;"></div>
                <button type="submit" class="btn-enviar">Agendar Cita</button>
                <p class="nota-envio">La cita quedará registrada en nuestro sistema. Te confirmaremos por WhatsApp.</p>
            </form>
        </section>

    </main>

    <footer class="footer">
        <div class="redes-sociales">
            <div class="red-box iluminado">
                <a href="https://www.instagram.com/jd_fashionyglamuor_?igsh=MXJqYmdjaXphdmx5dA==" target="_blank">
                    <i class="fab fa-instagram"></i> Instagram
                </a>
            </div>
            <div class="red-box iluminado">
                <a href="https://wa.me/3169957949?text=Hola,%20me%20gustaría%20agendar%20una%20cita." target="_blank">
                    <i class="fab fa-whatsapp"></i> WhatsApp
                </a>
            </div>
        </div>
        <p>&copy; 2025 Glamour & Citas. Todos los derechos reservados.</p>
    </footer>

    <!-- Librería SheetJS para leer Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sql.js@1.10.3/dist/sql-wasm.js"></script>
    <script src="js/main.js"></script>
    <script src="js/database.js"></script>
    <script src="js/sql-database.js"></script>
    <script src="js/citas.js"></script>
    <script>
        // Configurar fecha mínima (hoy)
        document.addEventListener('DOMContentLoaded', function() {
            const fechaInput = document.getElementById('fecha');
            if (fechaInput) {
                const hoy = new Date().toISOString().split('T')[0];
                fechaInput.setAttribute('min', hoy);
            }
            
            // Manejar envío del formulario
            const formulario = document.getElementById('formularioCita');
            if (formulario) {
                formulario.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const nombre = document.getElementById('nombre').value;
                    const telefono = document.getElementById('telefono').value;
                    const email = document.getElementById('email').value;
                    const fecha = document.getElementById('fecha').value;
                    const hora = document.getElementById('hora').value;
                    const servicioId = document.getElementById('servicio').value;
                    const notas = document.getElementById('deseo').value;
                    
                    if (!servicioId) {
                        mostrarMensaje('Por favor selecciona un servicio', 'error');
                        return;
                    }
                    
                    // Guardar automáticamente en segundo plano (sin mostrar mensajes)
                    guardarNuevaCita({
                        nombre,
                        telefono,
                        email,
                        fecha,
                        hora,
                        servicioId,
                        notas
                    }).then(resultado => {
                        if (resultado.exito) {
                            // Guardar silenciosamente - sin mostrar mensajes
                            console.log('✓ Cita guardada automáticamente:', resultado.cita.id);
                            
                            // Resetear formulario automáticamente
                            formulario.reset();
                            
                            // Enviar por WhatsApp automáticamente (sin interrumpir)
                            const servicio = window.datosBase?.servicios?.find(s => 
                                s['ID_Servicio (PK)'] == servicioId || s.ID_Servicio == servicioId
                            );
                            const nombreServicio = servicio?.['Nombre_Servicio'] || servicio?.Nombre_Servicio || 'Servicio';
                            const mensaje = `Hola, he agendado una cita:\n\nNombre: ${nombre}\nServicio: ${nombreServicio}\nFecha: ${fecha}\nHora: ${hora}\n\nID de cita: ${resultado.cita.id}`;
                            const urlWhatsApp = `https://wa.me/3169957949?text=${encodeURIComponent(mensaje)}`;
                            window.open(urlWhatsApp, '_blank');
                        } else {
                            // Solo mostrar error si algo falla
                            mostrarMensaje(resultado.mensaje, 'error');
                        }
                    }).catch(error => {
                        console.error('Error:', error);
                        // Solo mostrar error si algo falla
                        mostrarMensaje('Error al guardar la cita. Intenta nuevamente.', 'error');
                    });
                });
            }
        });
        
        function mostrarMensaje(mensaje, tipo) {
            const div = document.getElementById('mensajeValidacion');
            if (div) {
                div.style.display = 'block';
                div.textContent = mensaje;
                div.style.background = tipo === 'exito' ? 'rgba(76, 175, 80, 0.2)' : 'rgba(244, 67, 54, 0.2)';
                div.style.color = tipo === 'exito' ? '#4CAF50' : '#f44336';
                div.style.border = `1px solid ${tipo === 'exito' ? '#4CAF50' : '#f44336'}`;
                
                setTimeout(() => {
                    div.style.display = 'none';
                }, 5000);
            }
        }
    </script>
</body>
</html>

